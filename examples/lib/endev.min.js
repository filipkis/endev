/*! endev 0.2.0 2015-03-10 */
!function(a,b,c,d){function e(){function c(a){this.expression=a,this.lhs=a.split(h)[0].trim(),this.rhs=a.split(h)[1].trim(),this.operator=h.exec(a),this.replace=function(a){return this.lhs+this.operator+a}}var e=new RegExp(/ AND | OR  /i),h=new RegExp(/[=!><]+| (?:NOT )?LIKE | (?:NOT )?IN | IS (?:NOT )?NULL | (?:NOT )?MATCHES /),i=(new RegExp(/^(?:[a-zA-Z_$][0-9a-zA-Z_$]*\.)*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)/),function(){return JSON.stringify({"this":this,args:arguments})});this.from=function(a){if(b.isObject(a)){attrs.from?b.map(a.from.split(","),function(a){return{source:a.split(" ")[0],label:a.split(" ")[1]}}):[],attrs.where?b.map(attrs.where.split(e),function(a){return new c(a)}):[]}};try{angular.module("firebase"),this.app=angular.module("Endev",["firebase"])}catch(j){this.app=angular.module("Endev",[])}var k=angular.injector(["ng","Endev"]);this.app.directive("import",["$rootScope",function(b){return{compile:function(c,d){angular.forEach(d.import.split(","),function(c){c=c.trim(),b[c]=a[c]})}}}]),this.app.directive("data",["$rootScope","$http","$injector","$interval","$timeout","$log","$interpolate",function(a,b,d,h,i,j,k){return{restrict:"E",scope:!0,link:function(a,b,l){var m=l.delay?a.$eval(l.delay):0;a.$eval(l.pending),a.$pending=!0,a.$error=null,a.$success=!1;var n=0,o=function(){if(a.$parent.$pending)i(o,100);else{var b=k(l.from,!1,null,!0)(a),h=d.get(l.provider?"$endev"+l.provider[0].toUpperCase()+l.provider.slice(1):0==b.search(/http(s)?:\/\//)?"$endevRest":"$endevYql"),p=l.from.split(" ")[1],q=[];if(l.where&&(q=l.where.split(e).map(function(a){return new c(a)})),a.$eval(l.pending),a.$pending=!0,a.$error=null,a.$success=!1,l.log){var r=new f;r.query=new g,r.query.from=b,r.query.where=l.where}h.query(a,b,l.where,q,l).then(function(b){console.log(b),a[p]=b.query?b.query.results:b,a.$eval(l.success),a.$pending=!1,a.$success=!0,l.log&&(r.results=a[p],j.info(r))}).catch(function(b){a.$eval(l.error),a.$pending=!1,a.$success=!1,a.$error=b.description,l.retry&&(a.$pending=!0,i(o,m)),l.log&&(r.data=b,j.error(r))}),0==n&&(q.forEach(function(b){a.$watch(b.rhs,o)}),l.$observe("from",o)),n++}};i(o,m),l.refresh&&h(o,l.refresh)}}}]),this.app.service("$endevYql",["$http","$q",function(a,b){return{query:function(c,d,e,f){for(var g=e,h=0;h<f.length;h++){var i=c.$eval(f[h].rhs);g=g.replace(f[h].expression,f[h].replace("'"+i+"'"))}var j=d.split(" ")[0],k=d.split(" ")[1],l=new RegExp(k+".","g");if(g)var m=g.replace(l,"");else var m="";var n="select * from "+j+" where "+m,o=b.defer();return a.get("https://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(n)+"&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&format=json").success(function(a){o.resolve(a)}).error(function(a){o.reject(a)}),o.promise}}}]),this.app.service("$endevRest",["$http","$interpolate","$q",function(a,b,c){return{query:function(b,d,e,f,g){for(var h="",i=0;i<f.length;i++){var j=b.$eval(f[i].rhs);h+=f[i].lhs+"="+encodeURIComponent(j),i<f.length-1&&(h+="&")}var k=d.split(" ")[0],l=d.split(" ")[1],m=new RegExp(l+".","g"),n=h.replace(m,""),o=b.$eval(g.headers),p={headers:o,transformResponse:function(a,c){if("application/atom+xml"==c()["content-type"]){var d=new X2JS;return d.xml_str2json(a)}return b.$eval(a)}},q=k;q=-1!=q.indexOf("?")?q+"&"+n:q+"?"+n;var r=c.defer();return a.get(q,p).success(function(a){r.resolve(a)}).error(function(a){r.reject(a)}),r.promise}}}]),b.each([["if","ng-show"],["click","ng-click"],["evalue","ng-model"]],function(a){this.app.directive(a[0],["$compile",function(b){return{terminal:!0,priority:1e3,compile:function(c,d){return c.attr(a[1],d[a[0]]),c.removeAttr("data-"+a[0]),{pre:function(){},post:function(a,c){b(c)(a)}}}}}])},this),this.app.directive("else",["$compile",function(a){return{terminal:!0,priority:1e3,compile:function(c,d){var e=b.find(c.parent().children(),function(a){return angular.element(a).next()[0]==c[0]});return e&&angular.element(e).attr("ng-show")?d.$set("ng-show","!"+angular.element(e).attr("ng-show")):console.log("data-else needs to come directly after data-if tag"),c.removeAttr("data-else"),{pre:function(){},post:function(b,c){a(c)(b)}}}}}]),this.app.directive("list",["$compile",function(a){return{terminal:!0,priority:1e3,compile:function(b,c){return b.parent().prepend("<span class='__endev_annotation__' ng-if='$annotation'>"+c.list+"</span>"),c.$set("ng-class","{'__endev_list_item_annotated__':$annotation}"),c.$set("ng-repeat",c.list),b.removeAttr("data-list"),{pre:function(){},post:function(b,c){var d=a(c)(b);b.$watch("$annotation",function(a){a?(d.parent().addClass("__endev_annotated__"),angular.element(d.parent().children()[0]).removeClass("ng-hide")):(d.parent().removeClass("__endev_annotated__"),angular.element(d.parent().children()[0]).addClass("ng-hide"))})}}}}}]),this.app.directive("object",["$q",function(a){return{scope:!0,compile:function(b,c){return b.prepend("<span class='__endev_annotation__' ng-if='$annotation'>"+c.object+"</span>"),{pre:function(){},post:function(b,c,d){d.$addClass("ng-hide");var e=d.object.split("=")[0].trim(),f=d.object.split("=")[1].trim();b.$watch(e,function(a){a?d.$removeClass("ng-hide"):d.$addClass("ng-hide")}),b.$watch("$annotation",function(a){a?d.$addClass("__endev_annotated__"):d.$removeClass("__endev_annotated__")}),c.on("click",function(){console.log("Clicked object")});var g;b.$watch(f,function(c){a.when(c).then(function(a){a&&a.$bindTo?(g&&g(),a.$bindTo(b,e).then(function(a){g=a})):b[e]=a})})}}}}}]),this.app.run(["$rootScope",function(a){a.Date=Date,a.Math=Math,a.$annotation=!1}]),k.has("$firebase")&&(this.app.service("$endevFirebase",["$http","$firebase","$window",function(a,b,c){return{query:function(a,d){var e=new c.Firebase("https://endev.firebaseio.com"),f=d.split(" ")[0];return f=f.replace(".","/"),b(e.child(f)).$asArray().$loaded()}}}]),this.app.run(["$rootScope","$FirebaseArray","$FirebaseObject","$firebase","$q",function(a,c,e,f,g){if(a.from=b.memoize(function(a){var d=new Firebase("https://endev.firebaseio.com"),e=f(d.child(a),{arrayFactory:c.$extendFactory({findOrNew:b.memoize(function(a,c){var d=g.defer();return this.$list.$loaded().then(function(e){var f=b.findWhere(e,a);f||(f=b.extend(a,c),f.$new=!0),d.resolve(f)}),result},JSON.stringify),findOrCreate:b.memoize(function(a,c){var d=g.defer();return this.$list.$loaded().then(function(e){var g=b.findWhere(e,a);if(g){var h=new Firebase(e.$inst().$ref().toString()+"/"+g.$id);f(h).$asObject().$loaded().then(function(a){b.extend(a,b.pick(c,function(b,c){return!a[c]&&angular.isArray(b)&&0===b.length})),d.resolve(a)})}else e.$add(b.extend(a,c)).then(function(a){f(a).$asObject().$loaded().then(function(a){b.extend(a,b.pick(c,function(b,c){return!a[c]&&angular.isArray(b)&&0===b.length})),d.resolve(a)})})}),d.promise},JSON.stringify),insert:function(a){this.$list.$add(a)},remove:function(a){this.$list.$remove(a)}}),objectFactory:c.$extendFactory({findOrNew:function(a,c){var d=g.defer();return this.$loaded().then(function(e){var f=b.findWhere(e,a);f||(f=b.extend(a,c),f.$new=!0),d.resolve(f)}),result},findOrCreate:function(a,c){var d=g.defer();return this.$list.$loaded().then(function(e){var g=b.findWhere(e,a);g?d.resolve(g):e.$add(b.extend(a,c)).then(function(a){d.resolve(f(a).$asObject())})}),d.promise},insert:function(a){this.$list.$add(a)},remove:function(a){this.$list.$remove(a)}})});return e.$asArray()}),Array.prototype.findOrNew=b.memoize(function(a,c){var d=b.findWhere(this,a);return d||(d=b.extend(a,c),d.$new=!0),d},i),Array.prototype.findOrCreate=b.memoize(function(a,c){var d=b.findWhere(this,a);return d||(d=b.extend(a,c),this.push(d)),d},i),Array.prototype.insert=function(a){a.$new=d,a.$deleted=d,a.createdAt=(new Date).getTime(),this.push(a)},Array.prototype.remove=function(a){this.splice(this.indexOf(a),1),a.$new=!0,a.$deleted=!0},this.document.getElementById("__endev_helper__")){var h=this.document.createElement("style");h.innerHTML="  .__endev_annotated__ {    outline: 1px solid rgba(255,0,0,0.5);    border: 1px solid rgba(255,0,0,0.5);    padding-top: 15px;    margin-top:5px;  }  .__endev_annotation__ {    display: none;  }  .__endev_annotated__ > .__endev_annotation__ {    display: block;    position: absolute;    margin-top: -17px;    font-size: 10px;    font-family: monospace;    background: rgba(255,255,125,0.5);    color: #666;    padding: 1px 3px;    border: 1px dashed rgba(255,0,0,0.5);    margin-left: 5px;    cursor: pointer;  }  .__endev_annotated__ > .__endev_annotation__:hover {    background: rgba(255,255,125,0.9);  }  .__endev_annotated__ > .__endev_list_item_annotated__ {    outline: 1px dashed rgba(255,0,0,0.5);  }  table.__endev_annotated__, thead.__endev_annotated__, tbody.__endev_annotated__, tfoot.__endev_annotated__  {    /*border: 1px solid red;*/    padding-top: 10px;    margin-top: 10px;  }  table .__endev_annotated__ > .__endev_annotation__ {    margin-top: -1px;  }",this.document.head.appendChild(h)}}]))}function f(){}function g(){}endev=a.endev=new e}(window||this,_),angular.element(document).ready(function(){angular.bootstrap(document,["Endev"])});