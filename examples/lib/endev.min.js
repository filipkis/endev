/*! endev 0.1.0 2014-09-14 */
!function(a){function b(){this.app=angular.module("Endev",[]),this.app.directive("data",["$rootScope","$http","$injector","$interval","$timeout","$log","$interpolate",function(a,b,e,f,g,h,i){return{restrict:"E",scope:!0,link:function(a,b,j){var k=j.delay?a.$eval(j.delay):0;a.$eval(j.pending),a.$pending=!0,a.$error=null,a.$success=!1;var l=0,m=function(){if(a.$parent.$pending)g(m,100);else{var b=i(j.from,!1,null,!0)(a),f=e.get(j.provider?j.provider:0==b.search(/http(s)?:\/\//)?"$endev-rest":"$yql"),n=j.from.split(" ")[1],o=new RegExp(/ AND | OR  /i),p=new RegExp(/[=!><]+| (?:NOT )?LIKE | (?:NOT )?IN | IS (?:NOT )?NULL | (?:NOT )?MATCHES /),q=[];if(j.where)for(var r=j.where.split(o),s=0;s<r.length;s++){var t={expression:r[s],lhs:r[s].split(p)[0].trim(),rhs:r[s].split(p)[1].trim(),operator:p.exec(r[s]),replace:function(a){return this.lhs+this.operator+a}};q.push(t)}if(a.$eval(j.pending),a.$pending=!0,a.$error=null,a.$success=!1,j.log){var u=new c;u.query=new d,u.query.from=b,u.query.where=j.where}if(f.query(a,b,j.where,q,j).success(function(b){a[n]=b.query?b.query.results:b,a.$eval(j.success),a.$pending=!1,a.$success=!0,j.log&&(u.results=a[n],h.info(u))}).error(function(b){a.$eval(j.error),a.$pending=!1,a.$success=!1,a.$error=b.description,j.retry&&(a.$pending=!0,g(m,k)),j.log&&(u.data=b,h.error(u))}),0==l){for(var s=0;s<q.length;s++)a.$watch(q[s].rhs,function(){m()});j.$observe("from",function(a){console.log(a),m()})}l++}};g(m,k),j.refresh&&f(m,j.refresh)}}}]),this.app.service("$yql",["$http",function(a){return{query:function(b,c,d,e){for(var f=d,g=0;g<e.length;g++){var h=b.$eval(e[g].rhs);f=f.replace(e[g].expression,e[g].replace("'"+h+"'"))}var i=c.split(" ")[0],j=c.split(" ")[1],k=new RegExp(j+".","g");if(f)var l=f.replace(k,"");else var l="";var m="select * from "+i+" where "+l;return a.get("https://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(m)+"&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&format=json")}}}]),this.app.service("$endev-rest",["$http","$interpolate",function(a){return{query:function(b,c,d,e,f){for(var g="",h=0;h<e.length;h++){var i=b.$eval(e[h].rhs);g+=e[h].lhs+"="+encodeURIComponent(i),h<e.length-1&&(g+="&")}var j=c.split(" ")[0],k=c.split(" ")[1],l=new RegExp(k+".","g"),m=g.replace(l,""),n=b.$eval(f.headers),o={headers:n,transformResponse:function(a,c){if("application/atom+xml"==c()["content-type"]){var d=new X2JS;return d.xml_str2json(a)}return b.$eval(a)}},p=j;return p=-1!=p.indexOf("?")?p+"&"+m:p+"?"+m,a.get(p,o)}}}]),this.app.run(["$rootScope",function(a){a.Date=Date,a.Math=Math}])}function c(){}function d(){}endev=a.endev=new b}(window||this),angular.element(document).ready(function(){angular.bootstrap(document,["Endev"])});