/*! endev 0.1.0 2014-09-12 */
!function(a){function b(){this.app=angular.module("Endev",[]),this.app.directive("data",["$rootScope","$http","$injector","$interval","$timeout","$log","$interpolate",function(a,b,e,f,g,h,i){return{restrict:"E",scope:!0,link:function(a,b,j){var k=i(j.from,!1,null,!0)(a),l=e.get(j.provider?j.provider:0==k.search(/http(s)?:\/\//)?"$endev-rest":"$yql"),m=j.from.split(" ")[1],n=new RegExp(/ AND | OR  /i),o=new RegExp(/[=!><]+| (?:NOT )?LIKE | (?:NOT )?IN | IS (?:NOT )?NULL | (?:NOT )?MATCHES /),p=[],q=j.delay?a.$eval(j.delay):0;if(j.where)for(var r=j.where.split(n),s=0;s<r.length;s++){var t={expression:r[s],lhs:r[s].split(o)[0].trim(),rhs:r[s].split(o)[1].trim(),operator:o.exec(r[s]),replace:function(a){return this.lhs+this.operator+a}};p.push(t)}a.$eval(j.pending),a.$pending=!0,a.$error=null,a.$success=!1;var u=function(){if(a.$eval(j.pending),a.$pending=!0,a.$error=null,a.$success=!1,j.log){var b=new c;b.query=new d,b.query.from=k,b.query.where=j.where}l.query(a,k,j.where,p,j).success(function(c){a[m]=c.query?c.query.results:c,a.$eval(j.success),a.$pending=!1,a.$success=!0,j.log&&(b.results=a[m],h.info(b))}).error(function(c){a.$eval(j.error),a.$pending=!1,a.$success=!1,a.$error=c.description,j.retry&&(a.$pending=!0,g(u,q)),j.log&&(b.data=c,h.error(b))})};g(u,q),j.refresh&&f(u,j.refresh);for(var s=0;s<p.length;s++)a.$watch(p[s].rhs,function(){u()})}}}]),this.app.service("$yql",["$http",function(a){return{query:function(b,c,d,e){for(var f=d,g=0;g<e.length;g++){var h=b.$eval(e[g].rhs);f=f.replace(e[g].expression,e[g].replace("'"+h+"'"))}var i=c.split(" ")[0],j=c.split(" ")[1],k=new RegExp(j+".","g");if(f)var l=f.replace(k,"");else var l="";var m="select * from "+i+" where "+l;return a.get("https://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(m)+"&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&format=json")}}}]),this.app.service("$endev-rest",["$http",function(a){return{query:function(b,c,d,e,f){for(var g="",h=0;h<e.length;h++){var i=b.$eval(e[h].rhs);g+=e[h].lhs+"="+encodeURIComponent(i),h<e.length-1&&(g+="&")}var j=c.split(" ")[0],k=c.split(" ")[1],l=new RegExp(k+".","g"),m=g.replace(l,""),n=b.$eval(f.headers),o={headers:n,transformResponse:function(a,b){if("application/atom+xml"==b()["content-type"]){var c=new X2JS;return c.xml_str2json(a)}return a}},p=j;return p=-1!=p.indexOf("?")?p+"&"+m:p+"?"+m,a.get(p,o)}}}]),this.app.run(["$rootScope",function(a){a.Date=Date,a.Math=Math}])}function c(){}function d(){}endev=a.endev=new b}(window||this),angular.element(document).ready(function(){angular.bootstrap(document,["Endev"])});