/*! endev 0.2.0 2015-03-15 */

!function(a,b,c,d){function e(){function c(a,c){this.expression=a,this.lhs=a.split(i)[0].trim(),this.rhs=a.split(i)[1].trim(),this.operator=i.exec(a),this.attribute=this.lhs.replace(new RegExp("^"+c+".","g"),""),this.setValue=function(a){return this.value=a,this.obj=b.reduceRight(this.attribute.split("."),function(a,b){var c={};return c[b]=a,c},a),a},this.replace=function(a){return(this.attribute||this.lhs)+this.operator+a}}function e(a,b){return b=angular.isArray(b)?b:[b],b.concat(a)}var h=new RegExp(/ AND | OR  /i),i=new RegExp(/[=!><]+| (?:NOT )?LIKE | (?:NOT )?IN | IS (?:NOT )?NULL | (?:NOT )?MATCHES /),j=(new RegExp(/^(?:[a-zA-Z_$][0-9a-zA-Z_$]*\.)*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)/),new RegExp(/^[a-zA-Z_$][0-9a-zA-Z_$]*/));b.merge=function(a){var c=/#{\s*?_\s*?}/,d=Array.prototype.slice;return b.each(d.call(arguments,1),function(d){for(var e in d)if(b.isNull(a[e])||b.isUndefined(a[e])||b.isFunction(a[e])||b.isNull(d[e])||b.isDate(d[e]))a[e]=d[e];else if(b.isString(d[e])&&c.test(d[e]))b.isString(a[e])&&(a[e]=d[e].replace(c,a[e]));else if(b.isArray(a[e])||b.isArray(d[e])){if(!b.isArray(a[e])||!b.isArray(d[e]))throw new Error("Trying to combine an array with a non-array ("+e+")");a[e]=b.reject(b.merge(b.clone(a[e]),d[e]),function(a){return b.isNull(a)})}else if(b.isObject(a[e])||b.isObject(d[e])){if(!b.isObject(a[e])||!b.isObject(d[e]))throw new Error("Trying to combine an object with a non-object ("+e+")");a[e]=b.merge(b.clone(a[e]),d[e])}else a[e]=d[e]}),a},b.isMatchDeep=function(a,c){c=b.extendOwn({},c);var d=b.keys(c),e=d.length;if(null==a)return!e;for(var f=Object(a),g=0;e>g;g++){var h=d[g];if(b.isObject(c[h])){if(!b.isMatchDeep(a[h],c[h]))return!1}else if(c[h]!==f[h]||!(h in f))return!1}return!0},b.matcherDeep=function(a){return function(c){return b.isMatchDeep(c,a)}};this.from=function(a){if(b.isObject(a)){attrs.from?b.map(a.from.split(","),function(a){return{source:a.split(" ")[0],label:a.split(" ")[1]}}):[],attrs.where?b.map(attrs.where.split(h),function(a){return new c(a)}):[]}};try{angular.module("firebase"),this.app=angular.module("Endev",["endev-templates","firebase"])}catch(k){this.app=angular.module("Endev",["endev-templates"])}var l=angular.injector(["ng","Endev"]);this.app.directive("import",["$rootScope",function(b){return{compile:function(c,d){angular.forEach(d["import"].split(","),function(c){c=c.trim(),b[c]=a[c]})}}}]),this.app.directive("data",["$rootScope","$http","$injector","$interval","$timeout","$log","$interpolate",function(a,d,e,i,j,k,l){return{restrict:"E",scope:!0,link:function(a,d,m){var n=m.delay?a.$eval(m.delay):0;a.$eval(m.pending),a.$pending=!0,a.$error=null,a.$success=!1;var o=0,p=function(){if(a.$parent.$pending)j(p,100);else{var d=l(m.from,!1,null,!0)(a),i=d.split(" ")[0],q=e.get(m.provider?"$endev"+m.provider[0].toUpperCase()+m.provider.slice(1):0==d.search(/http(s)?:\/\//)?"$endevRest":"$endevYql"),r=m.from.split(" ")[1],s=m.where?m.where.split(h).map(function(b){var d=new c(b);return d.value=a.$eval(d.rhs),d.attribute=d.lhs.replace(new RegExp("^"+r+".","g"),""),d}):[];if(a.$eval(m.pending),a.$pending=!0,a.$error=null,a.$success=!1,m.log){var t=new f;t.query=new g,t.query.from=d,t.query.where=m.where}var u=b.defaults({from:i,where:m.where,params:s},b.extendOwn({},b.pick(m,function(a,b){return 0!=b.indexOf("$")})));q.query(u).then(function(b){a[r]=b,a.$eval(m.success),a.$pending=!1,a.$success=!0,m.log&&(t.results=a[r],k.info(t))})["catch"](function(b){a.$eval(m.error),a.$pending=!1,a.$success=!1,a.$error=b.description,m.retry&&(a.$pending=!0,j(p,n)),m.log&&(t.data=b,k.error(t))}),0==o&&(s.forEach(function(b){a.$watch(b.rhs,p)}),m.$observe("from",p)),o++}};j(p,n),m.refresh&&i(p,m.refresh)}}}]),this.app.service("$endevYql",["$http","$q",function(a,b){return{query:function(c){for(var d="",e=0;e<c.params.length;e++)d=c.where.replace(c.params[e].expression,c.params[e].replace("'"+c.params[e].value+"'"));var f="select * from "+c.from+" where "+d,g=b.defer();return a.get("https://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(f)+"&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&format=json").success(function(a){g.resolve(a.query.results)}).error(function(a){g.reject(a)}),g.promise}}}]),this.app.service("$endevRest",["$http","$interpolate","$q",function(a,b,c){return{query:function(b){for(var f="",g=0;g<b.params.length;g++)f+=b.params[g].attribute+"="+encodeURIComponent(b.params[g].value),g<b.params.length-1&&(f+="&");var h={headers:angular.isString(b.headers)?angular.fromJson(b.headers):angular.isObject(b.headers)?b.headers:d,transformResponse:e(a.defaults.transformResponse,function(a,b){if("application/atom+xml"==b()["content-type"]){var c=new X2JS;return c.xml_str2json(a)}return a})},i=b.from;i=-1!=i.indexOf("?")?i+"&"+f:i+"?"+f;var j=c.defer();return a.get(i,h).success(function(a){j.resolve(a)}).error(function(a){j.reject(a)}),j.promise}}}]),b.each([["if","ng-show"],["click","ng-click"]],function(a){this.app.directive(a[0],["$compile",function(b){return{terminal:!0,priority:1e3,compile:function(c,d){return c.attr(a[1],d[a[0]]),c.removeAttr("data-"+a[0]),{pre:function(){},post:function(a,c){b(c)(a)}}}}}])},this),this.app.directive("value",["$compile",function(a){return{priority:1e3,terminal:!0,compile:function(b,c){return"data-value"===c.$attr.value&&(b.attr("ng-model",c.value),b.removeAttr("data-value")),{pre:function(){},post:function(b,c,d){"data-value"===d.$attr.value&&a(c)(b)}}}}}]),this.app.directive("else",["$compile",function(a){return{terminal:!0,priority:1e3,compile:function(c,d){var e=b.find(c.parent().children(),function(a){return angular.element(a).next()[0]==c[0]});return e&&angular.element(e).attr("ng-show")?d.$set("ng-show","!"+angular.element(e).attr("ng-show")):console.log("data-else needs to come directly after data-if tag"),c.removeAttr("data-else"),{pre:function(){},post:function(b,c){a(c)(b)}}}}}]),this.app.directive("list",["$compile",function(a){return{terminal:!0,priority:1e3,compile:function(b,c){return b.parent().prepend("<span class='__endev_annotation__' ng-if='$annotation'>"+c.list+"</span>"),c.$set("ng-class","{'__endev_list_item_annotated__':$annotation}"),c.$set("ng-repeat",c.list),b.removeAttr("data-list"),{pre:function(){},post:function(b,c){var d=a(c)(b);b.$watch("$annotation",function(a){a?(d.parent().addClass("__endev_annotated__"),angular.element(d.parent().children()[0]).removeClass("ng-hide")):(d.parent().removeClass("__endev_annotated__"),angular.element(d.parent().children()[0]).addClass("ng-hide"))})}}}}}]),this.app.directive("object",["$q",function(a){return{scope:!0,compile:function(b,c){return b.prepend("<span class='__endev_annotation__' ng-if='$annotation'>"+c.object+"</span>"),{pre:function(){},post:function(b,c,d){d.$addClass("ng-hide");var e=d.object.split("=")[0].trim(),f=d.object.split("=")[1].trim();b.$watch(e,function(a){a?d.$removeClass("ng-hide"):d.$addClass("ng-hide")}),b.$watch("$annotation",function(a){a?d.$addClass("__endev_annotated__"):d.$removeClass("__endev_annotated__")}),c.on("click",function(){console.log("Clicked object")});var g;b.$watch(f,function(c){a.when(c).then(function(a){a&&a.$bindTo?(g&&g(),a.$bindTo(b,e).then(function(a){g=a})):b[e]=a})})}}}}}]),this.app.directive("endevAnnotation",[function(){return{scope:{},template:"<span class='__endev_annotation__' ng-if='$annotation'>{{annotation}}</span><div>{{formatedData}}</div>",link:function(a){a.$watch("data",function(b){a.formatedData=angular.toJson(b,!0)})}}}]),this.app.directive("fromE",["$interpolate","$endevProvider","$compile","$q",function(a,d,e){function f(a){return"OPTION"===a[0].tagName?a.parent():a}return{priority:1e4,restrict:"A",scope:!0,compile:function(g,i){if("DATA"!==g[0].tagName){var k=i.fromE,l=i.fromE.split(" ")[1],m="FROM "+i.fromE;i.where&&(m+=" WHERE "+i.where),i.$set("ng-repeat",l+" in $endevData_"+l),g.removeAttr("data-from-e");f(g).wrap("<span class='__endev_annotated__'></span>").parent().prepend("<span class='__endev_annotation__'>"+m+"</span>")}return{pre:function(){},post:function(f,g,i){if(g=e(g)(f),"DATA"!==g[0].tagName){if(angular.isDefined(f["$endevData_"+l]))throw new Error("Conflicting object "+lable+" defined by:",g);var m,n=a(k,!1,null,!0)(f),o=n.split(" ")[0],p=i.where?i.where.split(h).map(function(a){var b=new c(a,l);return b.setValue(f.$eval(b.rhs)),b}):[],q=null;if(i.provider)m=d.get(i.provider,k),f["$endevProvider_"+l]=m;else{var r=n.match(j);if(r){if(m=f["$endevProvider_"+r[0]],!m)throw new Error("No self or parent provider found for:",n);q=r[0]}}var s=b.map(p,function(a){return a.rhs});q&&s.push(q),s.length>0?f.$watchGroup(s,function(a){b.map(a.length>p.length?a.slice(0,-1):a,function(a,b){p[b].setValue(a)}),console.log("Params changed for ",k,a),u()}):i.$observe("fromE",function(a){n=a,console.log("From changed for",a),u()});var t=function(a){if(b.keys(a).length>3||!i["default"])f.$isDefault=!1;else{{f.$eval(i["default"])}a["default"]=f.$eval(i["default"]),f.$isDefault=!0}f["$endevData_"+l]=a},u=b.throttle(function(){if(console.log("Executed with params: ",p),m){var a=b.reduce(p,function(a,c){return b.merge(c.obj,a)},{}),c=b.defaults({from:o,where:i.where,params:p,filter:a},b.extendOwn({},b.pick(i,function(a,b){return 0!=b.indexOf("$")})));q&&(c.parentLabel=q,c.parentObject=f[q],c.parentData=f["$endevData_"+q]),m.query(c,null,t)["catch"](function(a){console.log("Query error: ",a)})}},100)}}}}}}]),this.app.directive("insertInto",["$interpolate","$endevProvider",function(a,c){return{scope:!0,link:function(d,e,f){var g,h=a(f.insertInto,!1,null,!0)(d);if(f.provider)g=c.get(f.provider,h);else{var i=h.match(j);if(i){if(g=d["$endevProvider_"+i[0]],!g)throw new Error("No self or parent provider found for:",h);parent=i[0]}}d.insert=function(a){console.log("Inserting:",a);var c={insertInto:h,newObject:a};parent&&(c.parentLabel=parent,c.parentObject=d[parent],c.parentData=d["$endevData_"+parent]),g.insert(c).then(function(c){b.isEqual(a,c)||(a=c)})}}}}]),this.app.directive("removeFrom",["$interpolate","$endevProvider",function(a,b){return{scope:!0,link:function(c,d,e){var f,g=a(e.removeFrom,!1,null,!0)(c);if(e.provider)f=b.get(e.provider,g);else{var h=g.match(j);if(h){if(f=c["$endevProvider_"+h[0]],!f)throw new Error("No self or parent provider found for:",g);parent=h[0]}}c.remove=function(a){console.log("Removing:",a);var b={removeFrom:g,newObject:a};parent&&(b.parentLabel=parent,b.parentObject=c[parent],b.parentData=c["$endevData_"+parent]),f.remove(b)}}}}]),this.app.service("$endevProvider",["$injector",function(a){return{get:function(b,c){return a.get(b?"$endev"+b[0].toUpperCase()+b.slice(1):0==c.search(/http(s)?:\/\//)?"$endevRest":"$endevYql")}}}]),this.app.run(["$rootScope","$document","$templateCache",function(a,b,c){a.Date=Date,a.Math=Math,a.$endevAnnotation=!1,angular.element(b[0].body).attr("ng-class","{'__endev_annotation_on__':$endevAnnotation}"),angular.element(b[0].body).append(c.get("endevHelper.tpl.html"))}]),l.has("$firebaseObject")&&(this.app.service("$endevFirebase",["$q","$firebaseObject","$firebaseArray",function(a,c,d){function e(a,c,d,e){return c?(path=b.findKey(e,function(a){return a==d})+"/"+a.substring(c.length+1),console.log("Path with parent:",path),h(e.$ref,path)):h(g,a)}function f(a,c){var d={$endevProviderType:"firebase",$ref:a.$ref()};return b.each(a,function(a,e){0!==!e.indexOf("$")&&b.isMatchDeep(a,c)&&(d[e]=a)}),d}var g=new Firebase("https://endev.firebaseio.com"),h=function(a,b){return a.child(b.replace(".","/"))},i=[],j=function(a){var c=b.find(i,function(b){return b.callback==a});return c||(c={callback:a},i.push(c)),c};return{query:function(b,d,g){var h=a.defer();j(g).unwatch&&j(g).unwatch();var i=e(b.from,b.parentLabel,b.parentObject,b.parentData);return c(i).$loaded().then(function(a){console.log("Data:",a);var c=f(a,b.filter);c.$endevRef=i,console.log("Object:",c),h.resolve(c),g&&angular.isFunction(g)&&g(c),j(g).unwatch=a.$watch(function(){console.log("Data changed:",a,b.where),c=f(a,b.filter),g&&angular.isFunction(g)&&g(c)})}),h.promise},insert:function(b){var c=a.defer(),f=e(b.insertInto,b.parentLabel,b.parentObject,b.parentData);return d(f).$loaded().then(function(a){a.$add(b.newObject).then(function(a){d(a).$loaded().then(function(a){c.resolve(a)})})}),c.promise},remove:function(a){console.log("Removing:",a.newObject);var d=e(a.removeFrom,a.parentLabel,a.parentObject,a.parentData);c(d).$loaded().then(function(d){var e=b.findKey(d,function(c){return b.isMatchDeep(c,a.newObject)});c(d.$ref().child(e)).$remove()})}}}]),this.app.run(["$rootScope","$firebaseArray","$firebaseObject","$q",function(a){if(a.from=b.memoize(function(){new Firebase("https://endev.firebaseio.com")}),this.document.getElementById("__endev_helper__")){var c=this.document.createElement("style");c.innerHTML=this.document.head.appendChild(c)}}]))}function f(){}function g(){}endev=a.endev=new e}(window||this,_),angular.element(document).ready(function(){angular.bootstrap(document,["Endev"])});
//# sourceMappingURL=endev.min.map