/*! endev 0.2.0 2015-03-03 */
!function(a,b,c){function d(){function b(a){this.expression=a,this.lhs=a.split(g)[0].trim(),this.rhs=a.split(g)[1].trim(),this.operator=g.exec(a),this.replace=function(a){return this.lhs+this.operator+a}}var d=new RegExp(/ AND | OR  /i),g=new RegExp(/[=!><]+| (?:NOT )?LIKE | (?:NOT )?IN | IS (?:NOT )?NULL | (?:NOT )?MATCHES /),h=new RegExp(/^(?:[a-zA-Z_$][0-9a-zA-Z_$]*\.)*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)/);this.app=angular.module("Endev",["firebase"]);angular.injector(["ng","Endev"]);this.app.directive("import",["$rootScope",function(b){return{compile:function(c,d){angular.forEach(d.import.split(","),function(c){c=c.trim(),b[c]=a[c]})}}}]),this.app.directive("data",["$rootScope","$http","$injector","$interval","$timeout","$log","$interpolate",function(a,c,g,h,i,j,k){return{restrict:"E",scope:!0,link:function(a,c,l){var m=l.delay?a.$eval(l.delay):0;a.$eval(l.pending),a.$pending=!0,a.$error=null,a.$success=!1;var n=0,o=function(){if(a.$parent.$pending)i(o,100);else{var c=k(l.from,!1,null,!0)(a),h=g.get(l.provider?l.provider:0==c.search(/http(s)?:\/\//)?"$endev-rest":"$yql"),p=l.from.split(" ")[1],q=[];if(l.where&&(q=l.where.split(d).map(function(a){return new b(a)})),a.$eval(l.pending),a.$pending=!0,a.$error=null,a.$success=!1,l.log){var r=new e;r.query=new f,r.query.from=c,r.query.where=l.where}h.query(a,c,l.where,q,l).success(function(b){a[p]=b.query?b.query.results:b,a.$eval(l.success),a.$pending=!1,a.$success=!0,l.log&&(r.results=a[p],j.info(r))}).error(function(b){a.$eval(l.error),a.$pending=!1,a.$success=!1,a.$error=b.description,l.retry&&(a.$pending=!0,i(o,m)),l.log&&(r.data=b,j.error(r))}),0==n&&(q.forEach(function(b){a.$watch(q[b].rhs,o)}),l.$observe("from",o)),n++}};i(o,m),l.refresh&&h(o,l.refresh)}}}]),this.app.service("$yql",["$http",function(a){return{query:function(b,c,d,e){for(var f=d,g=0;g<e.length;g++){var h=b.$eval(e[g].rhs);f=f.replace(e[g].expression,e[g].replace("'"+h+"'"))}var i=c.split(" ")[0],j=c.split(" ")[1],k=new RegExp(j+".","g");if(f)var l=f.replace(k,"");else var l="";var m="select * from "+i+" where "+l;return a.get("https://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(m)+"&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&format=json")}}}]),this.app.service("$endev-rest",["$http","$interpolate",function(a){return{query:function(b,c,d,e,f){for(var g="",h=0;h<e.length;h++){var i=b.$eval(e[h].rhs);g+=e[h].lhs+"="+encodeURIComponent(i),h<e.length-1&&(g+="&")}var j=c.split(" ")[0],k=c.split(" ")[1],l=new RegExp(k+".","g"),m=g.replace(l,""),n=b.$eval(f.headers),o={headers:n,transformResponse:function(a,c){if("application/atom+xml"==c()["content-type"]){var d=new X2JS;return d.xml_str2json(a)}return b.$eval(a)}},p=j;return p=-1!=p.indexOf("?")?p+"&"+m:p+"?"+m,a.get(p,o)}}}]),_.each([["if","ng-show"],["click","ng-click"],["value","ng-model"]],function(a){this.app.directive(a[0],["$compile",function(b){return{terminal:!0,priority:1e3,compile:function(c,d){return c.attr(a[1],d[a[0]]),c.removeAttr("data-"+a[0]),{pre:function(){},post:function(a,c){b(c)(a)}}}}}])},this),this.app.directive("else",["$compile",function(a){return{terminal:!0,priority:1e3,compile:function(b,c){var d=_.find(b.parent().children(),function(a){return angular.element(a).next()[0]==b[0]});return d&&angular.element(d).attr("ng-show")?c.$set("ng-show","!"+angular.element(d).attr("ng-show")):console.log("data-else needs to come directly after data-if tag"),b.removeAttr("data-else"),{pre:function(){},post:function(b,c){a(c)(b)}}}}}]),this.app.directive("list",["$compile",function(a){return{terminal:!0,priority:1e3,compile:function(b,c){return b.parent().prepend("<span class='__endev_annotation__' ng-if='$annotation'>"+c.list+"</span>"),c.$set("ng-class","{'__endev_list_item_annotated__':$annotation}"),c.$set("ng-repeat",c.list),b.removeAttr("data-list"),{pre:function(){},post:function(b,c){var d=a(c)(b);b.$watch("$annotation",function(a){a?(d.parent().addClass("__endev_annotated__"),angular.element(d.parent().children()[0]).removeClass("ng-hide")):(d.parent().removeClass("__endev_annotated__"),angular.element(d.parent().children()[0]).addClass("ng-hide"))})}}}}}]),this.app.directive("object",["$q",function(a){return{scope:!0,compile:function(b,c){return b.prepend("<span class='__endev_annotation__' ng-if='$annotation'>"+c.object+"</span>"),{pre:function(){},post:function(b,c,d){function e(){a.when(b.$eval(g)).then(function(a){a&&a.$bindTo?a.$bindTo(b,f):b[f]=a})}d.$addClass("ng-hide");var f=d.object.split("=")[0].trim(),g=d.object.split("=")[1].trim(),i=g.match(h)[0];"("===g.charAt(i.length)&&(i=i.lastIndexOf(".")>0?i.substring(0,i.lastIndexOf(".")):null),i&&(console.log(i),b.$watch(i,function(){e()})),b.$watch(f,function(a){a?d.$removeClass("ng-hide"):d.$addClass("ng-hide")}),b.$watch("$annotation",function(a){a?d.$addClass("__endev_annotated__"):d.$removeClass("__endev_annotated__")}),e()}}}}}]),this.app.service("PathMap",[function(){var a=[];return function(b,c){var d=_.find(a,function(a){return _.isEqual(a.key,this)},b);return d||(d={key:b,value:c(b)},a.push(d)),d.value}}]),this.app.run(["$rootScope","$FirebaseArray","$FirebaseObject","$firebase","$q","PathMap",function(a,b,d,e,f,g){if(a.Date=Date,a.Math=Math,a.$annotation=!1,a.from=function(a){return g({from:a},function(a){var c=new Firebase("https://endev.firebaseio.com"),d=e(c.child(a.from),{arrayFactory:b.$extendFactory({findOrNew:function(a,b){return g({object:this,find:a,init:b},function(a){var b=f.defer();return a.object.$list.$loaded().then(function(c){var d=_.findWhere(c,a.find);d||(d=_.extend(a.find,a.init),d.$new=!0),b.resolve(d)}),result})},findOrCreate:function(a,b){return g({object:this,find:a,init:b},function(a){var b=f.defer();return a.object.$list.$loaded().then(function(c){var d,f=_.findWhere(c,a.find);if(f)var g=new Firebase(c.$inst().$ref().toString()+"/"+f.$id);else c.$add(_.extend(a.find,a.init)).then(function(a){d=a});e(g).$asObject().$loaded().then(function(c){_.extend(c,_.pick(a.init,function(a,b){return!c[b]&&angular.isArray(a)&&0===a.length})),b.resolve(c)})}),b.promise})},insert:function(a){this.$list.$add(a)},remove:function(a){this.$list.$remove(a)}}),objectFactory:b.$extendFactory({findOrNew:function(a,b){var c=f.defer();return this.$loaded().then(function(d){var e=_.findWhere(d,a);e||(e=_.extend(a,b),e.$new=!0),c.resolve(e)}),result},findOrCreate:function(a,b){var c=f.defer();return this.$list.$loaded().then(function(d){var f=_.findWhere(d,a);f?c.resolve(f):d.$add(_.extend(a,b)).then(function(a){c.resolve(e(a).$asObject())})}),c.promise},insert:function(a){this.$list.$add(a)},remove:function(a){this.$list.$remove(a)}})});return d.$asArray()})},Array.prototype.findOrNew=function(a,b){return g({list:this,find:a,init:b},function(a){var b=_.findWhere(a.list,a.find);return b||(b=_.extend(a.find,a.init),b.$new=!0),b})},Array.prototype.findOrCreate=function(a,b){return g({list:this,find:a,init:b},function(a){var b=_.findWhere(a.list,a.find);return b||(b=_.extend(a.find,a.init),this.push(b)),b})},Array.prototype.insert=function(a){a.$new=c,a.$deleted=c,a.createdAt=(new Date).getTime(),this.push(a)},Array.prototype.remove=function(a){this.splice(this.indexOf(a),1),a.$new=!0,a.$deleted=!0},this.document.getElementById("__endev_helper__")){var h=this.document.createElement("style");h.innerHTML="  .__endev_annotated__ {    outline: 1px solid rgba(255,0,0,0.5);    border: 1px solid rgba(255,0,0,0.5);    padding-top: 15px;    margin-top:5px;  }  .__endev_annotation__ {    display: none;  }  .__endev_annotated__ > .__endev_annotation__ {    display: block;    position: absolute;    margin-top: -17px;    font-size: 10px;    font-family: monospace;    background: rgba(255,255,125,0.5);    color: #666;    padding: 1px 3px;    border: 1px dashed rgba(255,0,0,0.5);    margin-left: 5px;    cursor: pointer;  }  .__endev_annotated__ > .__endev_annotation__:hover {    background: rgba(255,255,125,0.9);  }  .__endev_annotated__ > .__endev_list_item_annotated__ {    outline: 1px dashed rgba(255,0,0,0.5);  }  table.__endev_annotated__, thead.__endev_annotated__, tbody.__endev_annotated__, tfoot.__endev_annotated__  {    /*border: 1px solid red;*/    padding-top: 10px;    margin-top: 10px;  }  table .__endev_annotated__ > .__endev_annotation__ {    margin-top: -1px;  }",this.document.head.appendChild(h)}}])}function e(){}function f(){}endev=a.endev=new d}(window||this),angular.element(document).ready(function(){angular.bootstrap(document,["Endev"])});