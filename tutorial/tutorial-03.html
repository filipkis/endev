<h2><a></a>3. Accessing API data</h2>
<p>In the previous chapters we have worked with data we created ourselves. We either created and stored it locally, in the browser, or using a service to store data in the cloud so it can be accessed from anywhere. Normally applications that we design will have some own data, as in our examples, but there is also plenty of data already out there, available through APIs, that can be used and combined to build useful, creative and fun applications. </p>
<!--<p>The data that is prepared to be accessed by our applications is made available through APIs (Application Programing Interfaces). According to a ProgrammableWeb, a website for tracking APIs and applications that use them, there is more than 14 500 APIs currently out there. They range from APIs for accessing social networks (Facebook, Twitter, Google Plus, etc.), through various online databases (IMDb, AllRecepies, etc.) to more and more open-governance trends where cities, municipalities and even countries create and expose APIs to relevant data (public transport information, weather, traffic, events, etc.). And with more and more devices getting connected (the Internet-of-Things buzzword) that number of APIs will grow quickly.</p>-->
<!--<p>There is a variety of issues concerned when working with API data. From finding the right data for your needs, understanding it, getting access to it (not all data is open or easily accessible), using the right technology to read it; all the way to increasingly popular field for data science that aims at developing complex algorithm combined with scientific analysis to gain new knowledge from it. It is for sure an interesting domain and even though you can probably find &ldquo;an app&rdquo; for anything these days, there are still plenty of possibilities for creating new or improving existing applications.</p>-->
<h4>3.1 Accessing the data from REST API</h4>
<p>In this chapter we will work with APIs and touch upon some of the mentioned issues and see how Endev combines various methods to resolve them. To start with let&rsquo;s look at a simple example of two APIs&nbsp;that are accessed through Endev annotations:</p>
<p data-height="480" data-theme-id="21624" data-slug-hash="MKobwv" data-default-tab="html" data-user="filipkis" class='codepen'>See the Pen <a href='http://codepen.io/filipkis/pen/MKobwv/'>Endev Tutorial: 3.1</a> by Filip Kis (<a href='http://codepen.io/filipkis'>@filipkis</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<p><span class="
glyphicon glyphicon-pencil text-primary" data-toggle="tooltip" data-placement="bottom" title="Do it yourself"></span> Try and see what happens when you add <span class="attribute">explain=</span><span class="statement">&quot;lottery&quot;</span> to the element that uses <span class="attribute">from</span> to query the lottery results.</p>
<p>
    <a href="#e31" data-toggle="collapse" class="btn btn-info btn-xs"  ng-click="explain('e31')">Explain the example</a>
    <div class="collapse" id="e31">
        <div class="well">
<p>Both examples use REST APIs which are basically web links but instead of going to a nice webpage they display raw data. The raw data can come in different formats, but in recent years JSON format (what you see for example if you look at <span><a href="http://apis.is/lottery">http://apis.is/lottery</a></span>) became most dominant. </p>
<p>If you click on the titles of the two APIs, they will lead you to the documentation where you can see what are all the API endpoints (other name for the API web addresses) and parameters (the values you see at the end web address, typically after &ldquo;?&rdquo; mark). On the Open Movie Database page we can see that there is only one endpoint (http://www.omdbapi.com/?) and there are several parameters that we can send. You can also test your inputs on their website, but the results are not very readable. </p>
<p>Let&rsquo;s get back to our example. In the first case we are using the <span class="attribute">from</span>&nbsp;annotation to access the movie API. As we before specified firebase:WishList and local:ToGetLis, now we use the web address to specify that we want to access the API. The address must include the &ldquo;http:&rdquo; or &ldquo;https:&rdquo; as that&rsquo;s how Endev knows it is a REST API. We can already see some parameters (i.e. ?<span class="statement">plot=short&amp;r=json</span>) defined in the web address. When accessing REST APIs you can choose whether&nbsp;to keep the parameters in the <span class="attribute">from</span>&nbsp;annotation or define them in the <span class="attribute">where</span> statement. Apart from <span class="attribute">where</span>&nbsp;statement being more readable, more importantly, it gives us a familiar way of defining conditions that link to other parts of the interface. In this example, we compare the <span class="statement">t</span>&nbsp;property to the value in the input field represented by <span class="statement">title</span> reference. As soon as we type something in the input box, the new API data will be retrieved that satisfies the given conditions.</p>
<p>In the second example we have a much simpler API that displays the results of Icelanding Lotto draws. The lottery API gives us data where the actual data of interest nested under the <span class="statement">results</span>&nbsp;property. Therefore, we need to use nested queries to access it. Luckily the documentation website contains the nice example where we see how the data looks like. However, as we saw with the previous example, that is not always the case. In such situations there is an <span class="attribute">explain</span>&nbsp;annotation that can be placed next to the <span class="attribute">from</span>&nbsp;annotation such as <span class="attribute">explain=</span><span class="statement">&quot;lottery&quot;</span>. <span class="
glyphicon glyphicon-pencil text-primary" data-toggle="tooltip" data-placement="bottom" title="Do it yourself"></span> Go and try it out and see what happens? The annotation temporary replaces anything that&rsquo;s inside the element annotated with <span class="attribute">from</span>&nbsp;and instead just displays the full data retrieved from the API. You can use it for testing and exploring the data.</p>
</div>
</div>
</p>
<h4>3.2 Using YQL service for uniformed access to supported APIs</h4>
<p>Working with API endpoint addresses tedious: finding the right address, knowing what parameters to use, different syntaxes and results formats, etc. &nbsp;It is time to bring out the fourth and final service provider (remember we had local storage, Firebase and REST so far) - Yahoo Query Language (YQL). YQL is an online service that can be seen as a proxy to many other data sources.</p>
<p>YQL uses what they call &ldquo;data tables&rdquo; to define different data sources. The tables have certain parameters (some optional, other mandatory) that can be set through <span class="attribute">where</span>&nbsp;conditions. Based on the table you specify and the conditions you set in your request, YQL knows how to transform that information into a call to the actual web service and then it reads and returns the results. </p>
<p>To explore what data sources YQL supports we can use&nbsp;<span><a href="http://developer.yahoo.com/yql/console/?q=select%20*%20from%20json%20where%20url%3D%22http%3A%2F%2Fapi.open-notify.org%2Fiss-now.json%22%20">YQL Console</a></span>. There you can see the list of supported tables on the left side by clicking on them an example of how to use them. The initial list contains only the tables that relate to Yahoo service (flicker, Yahoo Weather, etc.), but if you select &ldquo;Show Community Tables&rdquo; you can get more than 1000 tables that allow you to access many other services including popular ones like Twitter, Google, etc. And all of those table and their data can be accessed through Endev. </p>
<p>Let&rsquo;s look at an example that uses YQL to access the public photos on from Flickr API. Furthermore, the example lets you save the photos to your private collection (using local store). The example contains minimal styling (the class attributes) to make it better fit on the page:</p>
<p data-height="460" data-theme-id="21624" data-slug-hash="ZQJGPo" data-default-tab="html" data-user="filipkis" class='codepen'>See the Pen <a href='http://codepen.io/filipkis/pen/ZQJGPo/'>Endev Tutorial: 3.2</a> by Filip Kis (<a href='http://codepen.io/filipkis'>@filipkis</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<p><span class="
glyphicon glyphicon-pencil text-primary" data-toggle="tooltip" data-placement="bottom" title="Do it yourself"></span> Try adding <span class="attribute">describe=</span><span class="statement">&quot;flickr.photos.search&quot;</span> to the element with similar <span class="attribute">from</span> and see what happens.</p>
<p>
    <a href="#e32" data-toggle="collapse" class="btn btn-info btn-xs"  ng-click="explain('e32')">Explain the example</a>
    <div class="collapse" id="e32">
        <div class="well">
<p>By now you probably know to first look for <span class="attribute">from</span> annotation as that is where we always start from. It looks similar to how we used it with local storage and Firebase, i.e. we start with stating the service and the data table we want to use <span class="statement">yql:flickr.photos.search</span> followed by <span class="statement">result</span>&nbsp;- the future reference label of our choosing that will hold the results. In the <span class="attribute">where</span> statement we specify the attributes that the API needs. If we are not sure what parameters can be used, we can use <span class="attribute">describe=</span><span class="statement">&quot;flickr.photos.search&quot;</span>&nbsp;annotation. <span class="
glyphicon glyphicon-pencil text-primary" data-toggle="tooltip" data-placement="bottom" title="Do it yourself"></span> Go ahead, try it out. It works similar to how we used <span class="attribute">explain</span>&nbsp;earlier to see all the raw data, just instead it show the possible parameters. This annotation works only with YQL service. It will not give us the meaning of the parameters, but it will link to API&rsquo;s documentation (when known to YQL) where more information on the parameters can be found. </p>
<p>The second <span class="attribute">from</span>&nbsp;annotation is an interesting new case. Flickr API returns a result that is not directly a collection of images. Instead it returns an object that has property called <span class="statement">photo</span> where the collection of photos matching our search will be present. Therefore, we need a second <span class="attribute">from</span>&nbsp;annotation that access that collection. This time we don&rsquo;t specify any service because Endev already knows where <span class="statement">result</span> comes from. Often data we work such nested collections and we will need to use nested queries to access them. </p>
<p>Another interesting case with Flick API is that it does not give us exact address of the image, but instead gives use pieces of information (server, server farm, id, etc.) that we then combine into a full address in the <span class="attribute">src</span> attribute of image element to show the photo. </p>
<p>The image tag also contains already familiar annotations for inserting the image into PhotoCollection local storage. We have, however, decided not to store the only the parts, but the full address in our private collection, therefore we combine it again when passing it into the <span class="statement">insert</span>&nbsp;statement.</p>
<p>Finally, we list the photos from our PhotoCollection.</p>
</div>
</div>
</p>
<h4>3.3 Accessing any API with YQL (and avoiding CORS problems)</h4>
<p>When working on the client side code, as we&rsquo;ve been working so far, there is a limitation to accessing certain APIs in the form of Cross-Origin Resource Sharing (CORS). CORS poses certain security risk and for those reasons it&rsquo;s normally not enabled, which in turn prevents us from accessing the data from the browser code. What we would need in such case is a server to read the needed data and send it back to us. However, because it&rsquo;s turned off by default, there are many open APIs that have no security concerns (they share the open data) but still are not accessible in this way. A small example is this API that gives the <span><a href="http://open-notify.org/Open-Notify-API/ISS-Location-Now/">location of the International Space Station</a></span>. Try reading it with Endev <span class="
glyphicon glyphicon-pencil text-primary" data-toggle="tooltip" data-placement="bottom" title="Do it yourself"></span>.</p>
<p>If you didn&rsquo;t get anything, that&rsquo;s OK. It is not supposed to work. Luckily, YQL can help with that as well. Let&rsquo;s finding out where the International Space Station is:</p>
<p data-height="220" data-theme-id="21624" data-slug-hash="obwWYm" data-default-tab="html" data-user="filipkis" class='codepen'>See the Pen <a href='http://codepen.io/filipkis/pen/obwWYm/'>Endev Tutorial: 3.3</a> by Filip Kis (<a href='http://codepen.io/filipkis'>@filipkis</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<p>
    <a href="#e33" data-toggle="collapse" class="btn btn-info btn-xs"  ng-click="explain('e33')">Explain the example</a>
    <div class="collapse" id="e33">
        <div class="well">
<p>In this example we use a special YQL data table called <span class="statement">json</span>&nbsp;that allows us to get the data from any REST API that returns JSON format. To specify the address of the API we use the <span class="attribute">url</span> parameter in the <span class="attribute">where</span> statement. There are other generic tables that can read CSV, HTML, XML, etc. And why does it solve the problem of CORS? Well, the actual data access and processing happens on the Yahoo servers and then CORS is not an issue.</p>
</div>
</div>
</p>
<p>And with this we&rsquo;ve gotten to an end of chapter 3.</p>
<h4><span class="glyphicon glyphicon-star text-primary" aria-hidden="true"></span> Do it yourself</h4>
<ol>
    <li><span class="glyphicon glyphicon-pencil text-primary" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Do it yourself"></span> Using YQL's <span class="statement">geo.places</span> and <span class="statement">weather.forecast</span> data tables make an interface that shows you the temperature for location you enter in a input box<div from="firebase:Answers an" where="an.id = '3.1'" default="{'id':'3.1'}" auto-insert="true" auto-update>
        <textarea data-value="an.answer" placeholder="Write comments to assignment if you have any" cols="50" class="form-control"></textarea>
    </div><button class="btn btn-xs btn-primary" data-click="insert({'id':'3.1'})" insert-into="firebase:Answers">Add another</button></li>
</ol>
<h4>In this chapter we&rsquo;ve covered</h4>
<ol>
    <li>How to access the <b>REST API data</b>&nbsp;using Endev</li>
    <li>How to use <b>YQL</b>&nbsp;service as the data provider to access plenty of APIs in a more consistent way</li>
    <li>Using <span class="attribute">explain</span>&nbsp;annotation to display the raw data returned by <span class="attribute">from</span>&nbsp;statements to get better understanding of the data</li>
    <li>Using <span class="attribute">describe</span>&nbsp;annotation to display the possible parameters for a <b>YQL</b>&nbsp;data table</li>
    <li>How to access any API, even if not directly supported by YQL, and avoid CORS problems using <span class="statement">yql:json</span></li>
</ol>

<hr>
<div style="padding-bottom: 20px" class="text-center">
    3/4
    <a href="#ch2" class="btn btn-primary pull-left" ng-click="track('Back to Chapter 2')">&lt; Previous</a>
    <a href="#ch4" class="btn btn-primary pull-right" ng-click="track('Chapter 4 started')">Next &gt;</a>
    <div class="clearfix"></div>
</div>

<script async src="//assets.codepen.io/assets/embed/ei.js"></script>